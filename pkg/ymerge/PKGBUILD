# SPDX-License-Identifier: BSD-2-Clause

pkgname=ymerge
pkgver="0.0.9"
pkgrel=1
pkgdesc="A Source-Based Package Manager for Arch Linux."
arch=(x86_64)
url="https://github.com/flying-dude/ymerge/"
license=(BSD)
depends=(pacman fmt git abseil-cpp)
makedepends=(cmake fmt nlohmann-json ninja)
provides=(ymerge)

source=(
    "https://github.com/flying-dude/ymerge/archive/refs/tags/${pkgver}.zip"
    "https://github.com/flying-dude/auracle/archive/320130056f7a471fda44b06392ca8399575422ba.zip"
    "https://github.com/flying-dude/pacman/archive/c2d4568d35173f92c17b6b93222bc101a63c9928.zip"
)

b2sums=('2b6fecd7a79c678b9a6cd233cd1ce006864154dadb099d909ffd820086655004a1bd24a1257ac649039d81a7dfcb2a017ee917de9823af554383ab1b6f3bb462'
        '25da964bf528f96a74d5156658a8e1abb3a3e1e6cfbe420b24537bcb83e8f4dea9113fddb846868a56efb9bc7e2a8a1407168bb655f8ba8ffcab97fc8544f1ef'
        'ab3796e2ed879d638b494c73df92c9188ceb39ed18e8c158eea57969c5a76fb8bbb36dc5f283dd4cb275163878c3d5ff192c90253b721f5cecac39098f756884')

build() {
    rm -r ymerge-${pkgver}/submodules/auracle
    mv auracle-* ymerge-${pkgver}/submodules/auracle

    rm -r ymerge-${pkgver}/submodules/pacman
    mv pacman-* ymerge-${pkgver}/submodules/pacman

    cd ymerge-${pkgver}

    cmake -S . -B build -GNinja \
        -DCMAKE_BUILD_TYPE=Release \
        -DCMAKE_SKIP_RPATH=On \
        -DYMERGE_VERSION="${pkgver}" \
        -DCMAKE_INSTALL_PREFIX:PATH='/usr'

    cmake --build build
}

package() {
    cd ymerge-*/build/
    DESTDIR="${pkgdir}" ninja install
}
