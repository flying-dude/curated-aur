# SPDX-License-Identifier: BSD-2-Clause

pkgname=efly
pkgver="0.0.7"
pkgrel=1
pkgdesc="Create Arch-based bootable disk images."
arch=(x86_64)
url="https://github.com/flying-dude/efly/"
license=(BSD)
depends=(python python-colorama dosfstools e2fsprogs squashfs-tools gptfdisk)
provides=(efly)
optdepends=(
'qemu-desktop: Unlock efly-qemu subcommand to launch disk images inside qemu.'
'edk2-ovmf: Support launching efly-qemu in UEFI boot mode.'
'tigervnc: Unlock efly-vncserver subcommand to easily launch a vnc server as unprivileged user.'
)
source=("https://github.com/flying-dude/efly/archive/refs/tags/${pkgver}.zip")
b2sums=('275bec3521396ffa8fc90a9792496a6d380e5abe1a6107e3c1ae08a44bfed08bee602a3c3c474c9e612ff2b79a2cc8b7cb7cc2aeb5499aec0f5d726de48ed49c')

build() {
    cd efly-*
    sed -i s/UNKNOWN_VERSION/$pkgver/ src/efly/elib.py
}

package() {
    cd efly-*

    mkdir --parents ${pkgdir}/usr/lib
    cp --recursive src/efly/ ${pkgdir}/usr/lib

    rm ${pkgdir}/usr/lib/efly/data
    cp --recursive data/ ${pkgdir}/usr/lib/efly/

    mkdir --parents ${pkgdir}/usr/bin
    ln -s /usr/lib/efly/efly ${pkgdir}/usr/bin/efly
}
